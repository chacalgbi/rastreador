<%= render "page_header" do %>
  <%= render "page_header_breadcrumb", title: "Bateria" do %>
    <li class="breadcrumb-item"><%= link_to "Admin", admin_path %></li>
  <% end %>

  <%= render "page_header_actions" do %>
    <%= link_to "Filtros", "#offcanvas_filters", "data-bs-toggle": "offcanvas", class: "btn btn-white" %>
    <%= link_to "Excluir Registros Antigos", "#offcanvas_delete_old", "data-bs-toggle": "offcanvas", class: "btn btn-danger" %>
    <%= link_to "Nova bateria", new_admin_battery_path, class: "btn btn-primary" %>
  <% end %>
<% end %>

<div class="page-body">
  <div class="container-xl">
    <div class="card">
      <div class="table-responsive">
        <table class="table table-vcenter table-nowrap card-table table-striped">
          <thead>
            <tr>
              <th><%= sort_link @search, :device_id %></th>
              <th><%= sort_link @search, :device_name %></th>
              <th><%= sort_link @search, :user_name %></th>
              <th><%= sort_link @search, :bat %></th>
              <th><%= sort_link @search, :bkp %></th>
              <th><%= sort_link @search, :created_at %></th>
              <th class="w-1"></th>
            </tr>
          </thead>
          <tbody>
            <% @batteries.each do |battery| %>
              <tr>
                <td><%= battery.device_id %></td>
                <td><%= battery.device_name %></td>
                <td><%= battery.user_name %></td>
                <td><%= battery.bat %></td>
                <td><%= battery.bkp %></td>
                <td><%= battery.created_at %></td>
                <td>
                  <%= link_to "Ver", [:admin, battery], class: "btn btn-white btn-sm" %>
                  <%= link_to "Editar", edit_admin_battery_path(battery), class: "btn btn-white btn-sm" %>
                  <%= link_to "Deletar", [:admin, battery], class: "btn btn-white btn-sm", data: { method: :delete, confirm: "Tem certeza que deseja deletar?" } %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <div class="card-footer d-flex align-items-center fs-5">
        <div class="d-none d-md-block">
          <div>Download: <%= link_to "CSV", url_for(format: :csv, q: request.params[:q]) %></div>
          <%== pagy_info(@pagy) %>
        </div>
        <div class="ms-auto">
          <%== pagy_bootstrap_nav(@pagy) %>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="offcanvas_filters" tabindex="-1" class="offcanvas offcanvas-end">
  <div class="offcanvas-header">
    <h2 class="offcanvas-title">Filtros</h2>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
  </div>
  <%= search_form_for [:admin, @search], class: "offcanvas-body" do |f| %>

    <%= f.label :device_id_eq, "ID do Carro", class: "form-label" %>
    <%= f.text_field :device_id_eq, placeholder: "Digite o ID do carro", class: "form-control mb-3" %>


    <%= f.submit "Filtrar", class: "btn btn-primary" %>
    <%= link_to "Limpar Filtros", admin_batteries_path, class: "btn btn-white" %>
  <% end %>
</div>

<div id="offcanvas_delete_old" tabindex="-1" class="offcanvas offcanvas-end">
  <div class="offcanvas-header">
    <h2 class="offcanvas-title">Excluir Registros Antigos</h2>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <%= form_with url: destroy_old_batteries_admin_batteries_path, method: :delete, local: true do |f| %>
      <div class="alert alert-warning" role="alert">
        <strong>Atenção!</strong> Esta ação não pode ser desfeita. Todos os registros de bateria com data de atualização anterior à data selecionada serão permanentemente excluídos.
      </div>
      
      <%= f.label :delete_before_date, "Excluir registros anteriores a:", class: "form-label" %>
      <%= f.datetime_local_field :delete_before_date, class: "form-control mb-3", required: true %>
      
      <%= f.submit "Excluir Registros", class: "btn btn-danger", data: { confirm: "Tem certeza que deseja excluir todos os registros de bateria anteriores à data selecionada? Esta ação não pode ser desfeita." } %>
      <button type="button" class="btn btn-white" data-bs-dismiss="offcanvas">Cancelar</button>
    <% end %>
  </div>
</div>
